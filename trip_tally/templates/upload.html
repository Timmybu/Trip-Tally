{% extends 'base.html' %}
{% block content %}
<section>
  <h2>Upload Receipt</h2>
  <form action="{{ url_for('handle_upload') }}" method="post" enctype="multipart/form-data">
    <div class="dropzone" id="dropzone">
      <input type="file" id="file" name="file" accept="image/*" capture="environment" required />
      <p>Drag & drop or tap to select a photo</p>
    </div>
    <label for="trip_id">
      Trip (optional)
      <select name="trip_id" id="trip_id">
        <option value="">-- No Trip --</option>
        {% for trip in trips %}
        <option value="{{ trip.id }}">{{ trip.name }}</option>
        {% endfor %}
      </select>
    </label>
    <button type="submit">Process</button>
  </form>

  <hr />

  <h3>Or, Add Manual Expense</h3>
  <form action="{{ url_for('add_manual_expense') }}" method="post">
    <label for="manual_merchant">
      Merchant
      <input type="text" id="manual_merchant" name="merchant" placeholder="Merchant" required />
    </label>
    <label for="manual_date">
      Date
      <input type="date" id="manual_date" name="date" required />
    </label>
    <label for="manual_total">
      Total
      <input type="number" id="manual_total" name="total" step="0.01" placeholder="Total" required />
    </label>
    <label for="manual_tax">
      Tax (optional)
      <input type="number" id="manual_tax" name="tax" step="0.01" placeholder="Tax (optional)" />
    </label>
    <label for="manual_trip_id">
      Trip (optional)
      <select name="trip_id" id="manual_trip_id">
        <option value="">-- No Trip --</option>
        {% for trip in trips %}
        <option value="{{ trip.id }}">{{ trip.name }}</option>
        {% endfor %}
      </select>
    </label>
    <button type="submit">Add Manual Expense</button>
  </form>
</section>

<script>
  const dz = document.getElementById('dropzone');
  const fileInput = document.getElementById('file');
  dz.addEventListener('dragover', (e) => { e.preventDefault(); dz.classList.add('dragover'); });
  dz.addEventListener('dragleave', () => dz.classList.remove('dragover'));
  dz.addEventListener('drop', (e) => {
    e.preventDefault(); dz.classList.remove('dragover');
    if (e.dataTransfer.files && e.dataTransfer.files[0]) {
      fileInput.files = e.dataTransfer.files;
    }
  });
  dz.addEventListener('click', () => fileInput.click());
</script>
{% endblock %}


